*╔════════════════════════════════════════════════════════════════════════╗
*║ Файл Cnt_Emp      Разработчик Андрей Васин           29.10.97 09:39:56 ║
*╟────────────────────────────────────────────────────────────────────────╢
*║                                                                        ║
*║             Подсчет пустых бланков клиентов для площадок.              ║
*║                                                                        ║
*╚════════════════════════════════════════════════════════════════════════╝
PROCEDURE Cnt_Emp
PRIVATE cnt, n, c_s, nm, i

IF (sys_char # "A" .AND. sale_mode # "Mitin")
  USE (base_path+"PLACES")
  LOCATE FOR P_CHAR = sys_char
  nm = P_NAME
  USE (base_path+"ACCOUNT") ORDER TAG EMP_NAME
  SEEK sys_char
  COUNT REST WHILE SUBSYS = sys_char TO cnt
  USE
  DO View_1
ELSE
  n = 0
  USE (base_path+"PLACES")
  SCAN
    n = n+1
    DIMENSION cnt(n), c_s(n), nm(n)
    cnt(n)  = 0
    c_s(n) = P_CHAR
    nm(n)   = P_NAME
  ENDSCAN
  USE (base_path+"ACCOUNT") ORDER TAG EMP_NAME
  FOR i = 1 TO n
    SEEK c_s(i)
    COUNT REST WHILE SUBSYS = c_s(i) TO cnt(i)
  ENDFOR
  USE
  DO View_2
ENDIF

*╔═══════════════════════════════════════════════════════════════════════╗
*║                                                                       ║
*║                  Программа коррекции имени клиента.                   ║
*║                                                                       ║
*╚═══════════════════════════════════════════════════════════════════════╝
PROCEDURE View_1

*
*  Переменные состояния для навигации
*

PRIVATE stat_type     && Тип навигации: 0 - нестандартный;
                                        1 - бланк;
                                        2 - BROWSE - таблица;
                                        3 - BROWSE - список.
PRIVATE what_do       && Имя режима.
PRIVATE menu_name     && Имя асинхронного меню.
PRIVATE last_mouse    && Время последнего нажатия звериной кнопки.
PRIVATE win_name      && Имя окна ( окон для BROWSE ).

*
*   Заполняем значениями переменные состояния...
*
stat_type  = 1
what_do    = ""
menu_name  = ""
last_mouse = 0
win_name   = PROGRAM()

*------------------------------------------------------------------------
*    Содержательная часть программы:
*

*┌──────────────────────────────────────┐
*│                                      │
*│   Осталось 999999 бланков клиентов   │
*│                                      │
*│         Нажмите что-нибудь...        │
*│                                      │
*└──────────────────────────────────────┘

*------------------------------------------------------------------------

PUSH KEY CLEAR       && На всякий пожарный случай!
DO Prp_Nav_2
DO D_Win_N WITH 7, 42, "Площадка: "+ALLTRIM(nm)

*------------------------------------------------------------------------
*      Ввод полей бланка
*
@ 3, 2 SAY PADC("Осталось "+ALLTRIM(STR(cnt))+" бланков клиентов",WCOLS()-4)
@ 5, 2 SAY PADC("Нажмите что-нибудь...",WCOLS()-4)
= INKEY(0, "HM")
*--------------------------------------------------------------------------

POP KEY
RELEASE WINDOW (win_name)
RETURN

*╔═══════════════════════════════════════════════════════════════════════╗
*║                                                                       ║
*║                  Программа коррекции имени клиента.                   ║
*║                                                                       ║
*╚═══════════════════════════════════════════════════════════════════════╝
PROCEDURE View_2

*
*  Переменные состояния для навигации
*

PRIVATE stat_type     && Тип навигации: 0 - нестандартный;
                                        1 - бланк;
                                        2 - BROWSE - таблица;
                                        3 - BROWSE - список.
PRIVATE what_do       && Имя режима.
PRIVATE menu_name     && Имя асинхронного меню.
PRIVATE last_mouse    && Время последнего нажатия звериной кнопки.
PRIVATE win_name      && Имя окна ( окон для BROWSE ).

*
*   Заполняем значениями переменные состояния...
*
stat_type  = 1
what_do    = ""
menu_name  = ""
last_mouse = 0
win_name   = PROGRAM()

*------------------------------------------------------------------------
*    Содержательная часть программы:
*
PRIVATE i

*   Пустые бланки клиентов
*┌──────────────────────────────────┐
*│                                  │
*│  ....:....!....:....!.... 99999  │
*│                                  │
*│     Нажмите что-нибудь...        │
*│                                  │
*└──────────────────────────────────┘

*------------------------------------------------------------------------

PUSH KEY CLEAR       && На всякий пожарный случай!
DO Prp_Nav_2
DO D_Win_N WITH ALEN(cnt)+7, 38, "Пустые бланки клиентов"

*------------------------------------------------------------------------
*      Ввод полей бланка
*
FOR i = 1 TO ALEN(nm)
  @ 2+i, 4 SAY PADR(ALLTRIM(nm(i)),25)+STR(cnt(i),5)
ENDFOR
@ WROWS()-3, 2 SAY PADC("Нажмите что-нибудь...", WCOLS()-4)
*--------------------------------------------------------------------------
= INKEY(0,"HM")
POP KEY
RELEASE WINDOW (win_name)
RETURN
