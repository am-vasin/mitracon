*╔════════════════════════════════════════════════════════════════════════╗
*║   Имя файла Get_Shab     Разработчик Андрей Васин                      ║
*╟────────────────────────────────────────────────────────────────────────╢
*║                                                                        ║
*║               Ввод шаблона для поиска позиции в списках.               ║
*║                                                                        ║
*╚══════════════════════════════════════════════════════════ 07/17/2000 ══╝
PROCEDURE Get_Shb
PARAMETERS sValue, prmTit

*
*  Переменные состояния для навигации
*

PRIVATE stat_type     && Тип навигации: 0 - нестандартный;
                                        1 - бланк;
                                        2 - BROWSE - таблица;
                                        3 - BROWSE - список.
PRIVATE what_do       && Имя режима.
PRIVATE menu_name     && Имя асинхронного меню.
PRIVATE last_mouse    && Время последнего нажатия звериной кнопки.
PRIVATE win_name      && Имя окна ( окон для BROWSE ).

*
*   Заполняем значениями переменные состояния...
*
stat_type  = 1
what_do    = ""
menu_name  = ""
last_mouse = 0
win_name   = PROGRAM()

*------------------------------------------------------------------------
*    Содержательная часть программы:
*
*
*┌───────────────────────────────────────────────┐
*│                                               │
*│ Задайте шаблон ....:....!....:....!....:....! │
*│                                               │
*│          [ ] Искать во всех списках           │
*│                                               │
*│        < OK Ctrl-W > < Отказаться Esc >       │
*└───────────────────────────────────────────────┘

PRIVATE ex, tmpPatt, is_all
m.is_all = .F.
ex = 1
tmpPatt = IIF(TYPE("sValue") = "C", sValue, "")
*------------------------------------------------------------------------

PUSH KEY CLEAR       && На всякий пожарный случай!
DO Prp_Nav_2
DO D_Win_N WITH 9, 51, IIF(TYPE("prmTit") = "C", prmTit, "Контекстный поиск")
*DO Sun_Bord WITH  2,  2,  4, 49, " Заголовок рамки "

*------------------------------------------------------------------------
*      Ввод полей бланка
*

@ 3,  3 SAY "Задайте шаблон"
@ 3, 18 EDIT tmpPatt SIZE 1, 30 COLOR (SCHEME(1,1))
@ 5, 12 GET m.is_all PICTURE "@*C Искать во всех списках"
@ WROWS()-2, FLOOR(WCOLS()/2-16) GET ex PICTURE "@*HT \! OK Ctrl-W ;\? Отказаться Esc "

READ CYCLE

IF ex # 1 .OR. EMPTY(m.tmpPatt)
  *
  * Отрабатываем бланк
  tmpPatt = ""
ELSE
  tmpPatt = IIF(m.is_all, "!", " ")+tmpPatt
ENDIF
*--------------------------------------------------------------------------

POP KEY
RELEASE WINDOW (win_name)
RETURN tmpPatt
