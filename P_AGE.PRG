*╔═══════════════════════════════════════════════════════════════════════╗
*║                                                                       ║
*║                Установка предельного "возраста" для цен.              ║
*║                                                                       ║
*╚═══════════════════════════════════════════════════════════════════════╝
PROCEDURE P_Age
*
*  Переменные состояния для навигации
*

PRIVATE stat_type     && Тип навигации: 0 - нестандартный;
                                        1 - бланк;
                                        2 - BROWSE - таблица;
                                        3 - BROWSE - список.
PRIVATE what_do       && Имя режима.
PRIVATE menu_name     && Имя асинхронного меню.
PRIVATE last_mouse    && Время последнего нажатия звериной кнопки.
PRIVATE win_name      && Имя окна ( окон для BROWSE ).

*
*   Заполняем значениями переменные состояния...
*
stat_type  = 1
what_do    = ""
menu_name  = ""
last_mouse = 0
win_name   = PROGRAM()

*------------------------------------------------------------------------
*    Содержательная часть программы:
*

PRIVATE price_age, ex
                     &&   Объявляем и заполняем поля бланка
ex   = 1             &&
IF File_O(base_path+"P_AGE.MEM")
  RESTORE FROM (base_path+"P_AGE.MEM") ADDITIVE
ELSE
  price_age = 7
ENDIF

*------------------------------------------------------------------------
*       Сколько "держим" цены
*┌──────────────────────────────────┐
*│                                  │
*│       Количество дней 999        │
*│                                  │
*│ < OK Ctrl-W > < Отказаться Esc > │
*│                                  │
*└──────────────────────────────────┘

PUSH KEY CLEAR       && На всякий пожарный случай!
DO Prp_Nav_2
DO D_Win_N WITH 8, 38, 'Сколько "держим" цены'

*------------------------------------------------------------------------
*      Ввод полей бланка
*
@ 3, 9 SAY "Количество дней" GET price_age PICTURE "999" VALID Wrong()
@ 5, 3 GET ex PICTURE "@*HT \! OK Ctrl-W ;\? Отказаться Esc "

READ CYCLE

IF ex = 1
  SAVE ALL LIKE price_age TO (base_path+"P_AGE.MEM")
ENDIF
*--------------------------------------------------------------------------

POP KEY
RELEASE WINDOW (win_name)
RETURN

*╔═══════════════════════════════════════════════════════════════════════╗
*║                                                                       ║
*║                         Проверка правильности.                        ║
*║                                                                       ║
*╚═══════════════════════════════════════════════════════════════════════╝
PROCEDURE Wrong

IF READKEY() % 256 = 12
  RETURN .T.
ENDIF

IF price_age > 0
  RETURN .T.
ENDIF

PRIVATE mss
DIMENSION mss(3)
mss(1) = ""
mss(2) = CHR(0)+"Количество дней должно быть больше нуля!"
mss(3) = ""
DO Out_Mess WITH 7, "mss"

RETURN .F.
