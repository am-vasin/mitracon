*╔════════════════════════════════════════════════════════════════════════╗
*║ Файл Choose_P     Разработчик Андрей Васин           02.09.97 15:06:16 ║
*╟────────────────────────────────────────────────────────────────────────╢
*║                                                                        ║
*║                       Программа выбора площадки.                       ║
*║                                                                        ║
*╚════════════════════════════════════════════════════════════════════════╝
PROCEDURE Choose_P

*
*  Переменные состояния для навигации
*

PRIVATE stat_type     && Тип навигации: 0 - нестандартный;
                                        1 - бланк;
                                        2 - BROWSE - таблица;
                                        3 - BROWSE - список.
PRIVATE what_do       && Имя режима.
PRIVATE menu_name     && Имя асинхронного меню.
PRIVATE last_mouse    && Время последнего нажатия звериной кнопки.
PRIVATE win_name      && Имя окна ( окон для BROWSE ).

*
*   Заполняем значениями переменные состояния...
*
stat_type  = 1
what_do    = ""
menu_name  = ""
last_mouse = 0
win_name   = PROGRAM()

*------------------------------------------------------------------------
*    Содержательная часть программы:
*

*┌─────────────────────────────────────────────────┐
*│ ┌─────────────────────────────────────────────┐ │
*│ │                                             │ │
*│ └─────────────────────────────────────────────┘ │
*│                                                 │
*│        < OK Ctrl-W > < Отказаться Esc >         │
*└─────────────────────────────────────────────────┘

PRIVATE p_n, p_c, p_num, point
*------------------------------------------------------------------------
point = SELECT()

SELECT 0
USE (base_path+"PLACES") ALIAS P_WWWWW AGAIN
p_num = 1
DIMENSION p_n(p_num), p_c(p_num)
p_n(1) = PADR("Все площадки", FSIZE("P_NAME"))
p_c(1) = ""
SCAN
  p_num = p_num+1
  DIMENSION p_n(p_num), p_c(p_num)
  p_n(p_num) = P_NAME
  p_c(p_num) = P_CHAR
ENDSCAN

USE
SELECT (point)

IF p_num = 2
  RETURN ""
ENDIF

PUSH KEY CLEAR       && На всякий пожарный случай!
DO Prp_Nav_2
DO D_Win_N WITH ALEN(p_n)+3, LEN(p_n(1))+4, "Площадки"

*------------------------------------------------------------------------
*      Ввод полей бланка
*
point = 1
DO WHILE .T.
  point = MIN(point,ALEN(p_n))
  point = MAX(point,1)
  @ 1, 1 MENU p_n, ALEN(p_n)
  READ MENU TO point
  IF READKEY() % 256 = 15
    EXIT
  ENDIF
ENDDO

*--------------------------------------------------------------------------

POP KEY
RELEASE WINDOW (win_name)
RETURN p_c(point)
