USE Z:\MITRACON\STORE\BASE\ORD_D
SELECT 0
USE Z:\MITRACON\STORE\BASE\ORD_T ORDER TAG DOC_NUM DESCENDING
SELECT 0
USE Z:\MITRACON\STORE\BASE\LIST_DET ORDER TAG LIST
SELECT 0
USE Z:\MITRACON\STORE\BASE\LIST_TIT
CLEAR
? RECCOUNT()
NNN = 0
SCAN FOR EMPTY(SAL_NUM)
  NNN = NNN+1
  IF NNN%100 = 0
    WAIT WIND STR(NNN) NOWAIT
  ENDIF
  NN = 0
  NL = STR(LST_NUM, 6)
  SELECT LIST_DET
  SEEK NL
  SCAN REST WHILE LIST_NUM = NL
    IF QNT_REQ = 0
      LOOP
    ENDIF
    IF EMPTY(NN)
      SELECT ORD_T
      SEEK NL
      NN = LIST_TIT.ORD_NUM+1
      RD = REQ_DATE
      RT = REQ_TIME
      APPEND BLANK
      REPLACE	LIST_NUM	WITH NL,	;
      			LIST_NAME	WITH LIST_TIT.LST_NAME,	;
      			ORD_NUM		WITH NN,	;
      			ORD_DATE	WITH DATE(),;
      			ORD_TIME	WITH TIME(),;
      			WHO			WITH 1,		;
      			WHERE		WITH "13",	;
      			REQ_DATE	WITH RD,	;
      			REQ_TIME	WITH RT
    ENDIF
    SELECT ORD_D
    APPEND BLANK
    REPLACE LIST_NUM	WITH NL,	;
      		ORD_NUM		WITH NN,	;
      		CODE		WITH LIST_DET.CODE, ;
      		QNT			WITH -LIST_DET.QNT_REQ
    SELECT LIST_DET
    REPLACE QNT_REQ WITH 0
  ENDSCAN
  SELECT LIST_TIT
  IF .NOT. EMPTY(NN)
    REPLACE ORD_NUM WITH NN
  ENDIF
ENDSCAN
