*╔════════════════════════════════════════════════════════════════════════╗
*║   Имя файла Tst_Link     Разработчик Андрей Васин                      ║
*╟────────────────────────────────────────────────────────────────────────╢
*║                                                                        ║
*║                   Проверка алгоритма поиска позиции.                   ║
*║                                                                        ║
*╚══════════════════════════════════════════════════════════ 02/10/2000 ══╝
PROCEDURE Tst_Link
*
*  Переменные состояния для навигации
*
SET DELE ON
SET EXCLU OFF

USE Z:\STORE\BASE\STOCK
SELECT 0
USE LINK_POS ORDER TAG NAME1

PRIVATE stat_type     && Тип навигации: 0 - нестандартный;
                                        1 - бланк;
                                        2 - BROWSE - таблица;
                                        3 - BROWSE - список.
PRIVATE what_do       && Имя режима.
PRIVATE menu_name     && Имя асинхронного меню.
PRIVATE last_mouse    && Время последнего нажатия звериной кнопки.
PRIVATE win_name      && Имя окна ( окон для BROWSE ).

*
*   Заполняем значениями переменные состояния...
*
stat_type  = 1
what_do    = ""
menu_name  = ""
last_mouse = 0
win_name   = PROGRAM()

*------------------------------------------------------------------------
*    Содержательная часть программы:
*

*┌───────────────────────────────────────────────────────┐
*│ ┌─ Позиция ─────────────────────────────────────────┐ │
*│ │ XXXX XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX XXXXXXXX │ │
*│ └───────────────────────────────────────────────────┘ │
*│           < OK Ctrl-W > < Отказаться Esc >            │
*└───────────────────────────────────────────────────────┘

PRIVATE ex, p0, n0, f0, np
ex = 1
p0 = SPACE(4)
n0 = SPACE(35)
f0 = SPACE(8)
*------------------------------------------------------------------------

PUSH KEY CLEAR       && На всякий пожарный случай!
DO Prp_Nav_2
DO D_Win_N WITH 7, 59, "Проверка алгоритма поиска"
DO Sun_Bord WITH  2,  3,  4, 55, " Позиция "

*------------------------------------------------------------------------
*      Ввод полей бланка
*
DO WHILE .T.
  @ 3,  5 GET p0
  @ 3, 10 GET n0
  @ 3, 46 GET f0
  @ WROWS()-2, FLOOR(WCOLS()/2-16) GET ex PICTURE "@*HT \! OK Ctrl-W ;\? Отказаться Esc "

  READ CYCLE

  IF ex = 1
    np = Link_Pos(p0, n0, f0)
    *
    * Отрабатываем бланк
    IF BETWEEN(np, 1, RECCOUNT("STOCK"))
      GO np IN STOCK
      WAIT WINDOW STOCK.PREFIX+" "+STOCK.NAME+" "+STOCK.PRODUCER
    ELSE
      WAIT WIND "Ну ничего подходящего! (И не судите меня строго!)"
    ENDIF
  ELSE
    EXIT
  ENDIF
ENDDO
*--------------------------------------------------------------------------

POP KEY
RELEASE WINDOW (win_name)
RETURN
