*
*  Коррекция прихода
*
CLOSE DATA
DELETE FILE NEG_INC.DBF
DELETE FILE NEG_INC.CDX
CREATE DBF NEG_INC ;
	(	LINK		N(10),	;
		FIRM		C( 3),	;
		DOC_DATE	D,		;
		DOC_NUM		C(10),	;
		INV_TYPE	C(10),	;		
		LINK_P		C(24),	;
		FLG_BUY		C( 1),	;
		PARTY		C(12),	;
		CODE		N(10),	;
		QNT_INC		N(10),	;
		QNT_REP		N(10),	;
		QNT_REST	N(10),	;
		REST_REP	N(10)	)
SELECT 0
USE ACT_S_T ORDER TAG DOC_NUM
SELECT 0
USE ACT_S
SET RELA TO FIRM+LEFT(DTOS(DOC_DATE),4)+DOC_NUM INTO ACT_S_T
N = 0
SCAN
  N = N+1
  IF N%100 = 0
    WAIT WINDOW STR(N) NOWAIT
  ENDIF
  IF "!" $ DOC_NUM .OR. QNT_INC < 0
    SELECT NEG_INC
    APPEND BLANK
    REPLACE LINK		WITH RECNO("ACT_S"),	;
			FIRM		WITH ACT_S.FIRM,		;
			DOC_DATE	WITH ACT_S.DOC_DATE,	;
			DOC_NUM		WITH ACT_S.DOC_NUM,		;
			INV_TYPE	WITH ACT_S_T.INV_TYPE,	;		
			LINK_P		WITH FIRM+LEFT(DTOS(ACT_S_T.EXP_DATE), 4)+LEFT(ACT_S_T.EXP_NUM, 10),	;
			FLG_BUY		WITH ACT_S.FLG_BUY,		;
			CODE		WITH ACT_S.CODE,		;
			QNT_INC		WITH ACT_S.QNT_INC,		;
			QNT_REP		WITH ACT_S.QNT_REP,		;
			QNT_REST	WITH ACT_S.QNT_REST,	;
			REST_REP	WITH ACT_S.REST_REP
    SELECT ACT_S
  ENDIF 
ENDSCAN

CLOSE DATA

